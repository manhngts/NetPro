
## NetPro.Web.Api使用
 [![NuGet](https://img.shields.io/nuget/v/NetPro.Web.Api.svg)](https://nuget.org/packages/NetPro.Swagger)

封装了基本asp.netcore webapi工程需要的基本功能

### 安装

* Package Manager方式:
 `Install-Package NetPro.Web.Api -Version 3.1.2`

* .NET CLI 方式: 
`dotnet add package NetPro.Web.Api --version 3.1.2`

* PackageReference:
`<PackageReference Include="NetPro.Web.Api" Version="3.1.2" />`

* .NET CLI 方式:
 `paket add NetPro.Web.Api --version 3.1.2`

---

## 支持以下几种开发方式

### 1、简化版
 API主程序集下每个业务模块一个文件夹隔离，业务模块下包含此业务模块的Controller、Service、Entity等等

### 2、程序集隔离

每个业务模块一个程序集，每个程序集中包含当前业务模块需要的所有Controller、Service、Entity等等，再API主程序集引用需要的业务模块，业务模块之间尽可能不互相依赖，引用。

### 3、插件方式

在`2、程序集隔离`的基础上，API主程序集不直接引用需要的业务模块程序集，而是将各业务模块程序集放置在指定的插件文件夹中，插件路径配置如下：
```json
"TypeFinderOption": {
		"MountePath": ""//windows默认目录： C:/opt/netpro ; linux环境：/opt/netpro
	},
```
---
#### 注意

引用程序集会自动注入相关服务，无需再进行Service.Add..();

### 使用

#### appsetting.json

```json
      //按需要配置以下节点，可忽略
      "NetProOption": {
		//"UseResponseCompression": false, //是否启用响应压缩		
		//"ApplicationName": "", //应用名称
		//"RequestWarningThreshold": 5, //请求时长的警告临界值
		//"RoutePrefix": "api" //全局路由前缀
        "IsDebug":true//Debug模式,默认true，方便线上调试
	},

```

内置中间件与系统中间件的映射关系：
```csharp

public void Configure(IApplicationBuilder app, IWebHostEnvironment env)
{
	
    app.UseExceptionHandler();   //对应ErrorHandlerStartup
    
	// your code
	...//此区间请求管道上的Order取值 范围0-100

    app.UseStaticFiles();        //对应StaticFilesStartup

	// your code
	...//此区间请求管道上的Order取值 范围101-200

    app.UseRouting();            //对应RoutingStartup

    // your code
	...//此区间请求管道上的Order取值 范围200-1000

    app.UseEndpoints(endpoints =>//对应EndpointsStartup
    {
        endpoints.MapRazorPages();
    });
}
```
考虑到灵活性，Netpro.Web.APi不包含UseEndpoints处理，如果不是通过脚手架生成NetPro项目，需要手动增加以下文件`EndpointsStartup.cs`到项目中
```csharp
// <auto-generated>
//  UseEndpoints   
// </auto-generated>

using Microsoft.AspNetCore.Builder;
using Microsoft.Extensions.Configuration;
using Microsoft.Extensions.DependencyInjection;

namespace NetPro.Web.Api
{
    /// <summary>
    /// Endpoints 
    /// </summary>
    public class EndpointsStartup : INetProStartup
    {
        /// <summary>
        /// 
        /// </summary>
        /// <param name="services"></param>
        /// <param name="configuration"></param>
        /// <param name="typeFinder"></param>
        public void ConfigureServices(IServiceCollection services, IConfiguration configuration, TypeFinder.ITypeFinder typeFinder)
        {

        }

        /// <summary>
        /// 
        /// </summary>
        /// <param name="application"></param>
        public void Configure(IApplicationBuilder application)
        {
            application.UseEndpoints(s =>
            {
                s.MapControllers();//add other operation
            });
        }

        /// <summary>
        /// UseEndpoints should be loaded last
        /// </summary>
        public double Order { get; set; } = 1000;
    }
}

```

## Feature

### `IWebHelper`  Web助手
包含获取客户端ip、是否GET POST,操作Query

```C#
使用：构造函数注入即可

 private readonly IWebHelper _webHelper;

 public XXXController(
            IWebHelper webHelper)
        {
            _webHelper = webHelper;
        }

_webHelper.GetCurrentIpAddress();
```


### 全局异常
包含全局异常处理
异常响应如下

`System exception, please try again later`